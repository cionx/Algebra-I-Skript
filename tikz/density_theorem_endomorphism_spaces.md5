\begingroup \toks 0={macro:-> \node (A) {$A$}; \node (End kr) [below left = 4em and 2em of A] {$\End _{k^r}(M)$}; \node (plus End k) [below right = 4em and 2em of A] {$\bigoplus _{i=1}^r \End _k(M_i)$}; \draw [->>] (A) to (End kr); \draw [->] (A) to node[above right] {$\Phi $} (plus End k); \draw [double equal sign distance] (End kr) to node[above] {$\sim $} (plus End k); }\xdef \tikzexternallastkey {\the \toks 0 }\endgroup %
